# With the vader plugin installed, type ":Vader %" to run these tests

# Describe AddToBufferHistoryList()
Execute ('can add to the history list when it is empty'):
  :let w:buffer_history_list = []
  :call AddToBufferHistoryList('test_string')
  Assert w:buffer_history_list == ['test_string']

Execute ('can add to the history list when it is not empty'):
  :let w:buffer_history_list = ['test_1']
  :call AddToBufferHistoryList('test_string')
  Assert w:buffer_history_list == ['test_1', 'test_string']

Execute ('does not add an empty string to the history list'):
  :let g:buffer_history_list = ['test_in']
  :call AddToBufferHistoryList('')
  Assert g:buffer_history_list == ['test_in']

Execute ('does not add to the history list if skip_bufenter_autocmd is truthy'):
  :let g:skip_bufenter_autocmd = 1
  :let g:buffer_history_list = ['test_in']
  :call AddToBufferHistoryList('hi there')
  Assert g:buffer_history_list == ['test_in']
  :let g:skip_bufenter_autocmd = 0

Execute ('increments the current buffer index when the buffer history list gets bigger'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3']
  :let w:current_buffer_index = 2
  :call AddToBufferHistoryList('test_4')
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 3
  :let w:current_buffer_index = 0

Execute ('skips if the input buffer is the same as the one on the end of the list'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 3
  :call AddToBufferHistoryList('test_4')
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 3

Execute ('chops off the end of the list if the current buffer index is not on the end'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 1
  :call AddToBufferHistoryList('test_5')
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_5']
  Assert w:current_buffer_index == 2

Execute ('does not grow above the max history len value'):
  :let g:buffer_history_max_len = 2
  :let w:buffer_history_list = ['test_1', 'test_2']
  :let w:current_buffer_index = 1
  :call AddToBufferHistoryList('test_3')
  Assert w:buffer_history_list == ['test_2', 'test_3']
  Assert w:current_buffer_index == 1

# Describe HistoryGoBack()
Execute ('can go back from the end of the list'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 3
  :call HistoryGoBack()
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 2

Execute ('does not go back when the index is 0'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 0
  :call HistoryGoBack()
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 0

Execute ('does not decrement the index when the history list only has one entry'):
  :let w:buffer_history_list = ['test_1']
  :let w:current_buffer_index = 0
  :call HistoryGoBack()
  Assert w:buffer_history_list == ['test_1']
  Assert w:current_buffer_index == 0

# Describe HistoryGoForward()
Execute ('does not go forward when the index is at the head of the list'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 3
  :call HistoryGoForward()
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 3

Execute ('increments the index when it is not at the head of the list'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 2
  :call HistoryGoForward()
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 3

Execute ('resets the state of the index when it is too high'):
  :let w:buffer_history_list = ['test_1', 'test_2', 'test_3', 'test_4']
  :let w:current_buffer_index = 100
  :call HistoryGoForward()
  Assert w:buffer_history_list == ['test_1', 'test_2', 'test_3', 'test_4']
  Assert w:current_buffer_index == 3
